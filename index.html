<!DOCTYPE html>
<html lang="eng">

<head>
    <meta charset="utf-8" />
    <title>Autoglosser</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js" type="text/javascript"></script>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css"
        type="text/css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"
        type="text/javascript"></script>

    <style>
        table {
            display: table;
        }

        table tr {
            display: table-cell;
        }

        table tr td {
            display: block;
        }
    </style>
    <script type="text/javascript">
        $(document).ready(function () {
            $("#submit").click(function () {
                var that = this;

                $("#results").text("");

                console.log($("#inputtextarea").val())
                var lines = $("#inputtextarea").val().split("\n");
                var joined = lines
                    .filter((line) => line.trim() !== " ")
                    .join("");

                console.log(joined);
                var data = { 'moore': joined };
                var url = "cgi-bin/autogloss.py";

                console.log(data);

                $.ajax({
                    type: "GET",
                    url: url,
                    data: data,
                    dataType: "JSON",
                    success: function (jsonStr) {
                        console.log("[" + url + "]: " + JSON.stringify(jsonStr));
                        if (jsonStr["ambiguity"] == "False") {
                            if (jsonStr.hasOwnProperty("moore")) {
                                console.log(jsonStr["moore"]);
                                $("<p><i>Original:</i></p>").appendTo($("#results"));
                                $("<p>&emsp;" + jsonStr["moore"] + "</p> <br>").appendTo($("#results"));
                            }

                            if (jsonStr.hasOwnProperty("gloss")) {
                                console.log(jsonStr["gloss"]);
                                $("<p><i>Normalized Spelling + Gloss:</i></p>").appendTo($("#results"));
                                $("<p>&emsp;" + jsonStr["normSpl"] + "</p>").appendTo($("#results"));
                                $("<p>&emsp;" + jsonStr["gloss"] + "</p> <br>").appendTo($("#results"));
                            }

                            if (jsonStr.hasOwnProperty("latexGloss")) {
                                console.log(jsonStr["latexGloss"]);
                                $("<p><i>LaTeX Spelling + Gloss:</i></p>").appendTo($("#results"));
                                $("<p>&emsp;" + jsonStr["latexGloss"] + "</p>").appendTo($("#results"));
                                $("<p>&emsp;" + jsonStr["gloss"] + "</p> <br>").appendTo($("#results"));
                            }
                        } else {
                            $("<p>~~~</p>").appendTo($("#results"));
                            $("<p>Ambiguity was found</p>").appendTo($("#results"));
                            $("<p>~~~</p><br>").appendTo($("#results"));
                            $("<p>Initial input and gloss with ambiguity:</p>").appendTo($("#results"));
                            $("<tr><td>").appendTo($("#table"))
                            for (var i in jsonStr["moore"]) {
                                $("<p>" + jsonStr["moore"][i] + "</p>").appendTo($("#table"));
                            }
                            $("</td>").appendTo($("#table"));
                            $("<td>").appendTo($("#table"));
                            for (var i in jsonStr["gloss"]) {
                                $("<p>" + jsonStr["gloss"][i] + "</p>").appendTo($("#table"));
                            }
                            $("</td></tr>").appendTo($("#table"));



                        }
                    },
                    error: function (
                        XMLHttpRequest,
                        textStatus,
                        errorThrown,
                    ) {
                        console.log("[" + url + "]: Status: " + textStatus);
                        console.log("[" + url + "]: Error: " + errorThrown);
                        console.log("[" + url + "]: XMLHttpRequest: " + XMLHttpRequest);
                        $("#results").text("");
                    },
                });
            });
        });
    </script>

</head>

<body>
    <div id="userinputform">
        <form>
            <textarea rows="5" cols="60" placeholder="Input text here." id="inputtextarea"></textarea>
            <br />
            <input type="button" value="submit" id="submit" style="cursor: pointer" />
        </form>
    </div>

    <div id="results"></div>

    <div id="tableDiv" class="table_container">
        <table style="width:fit;color:red;" border="1" id="table">
        </table>
    </div>

</body>

</html>