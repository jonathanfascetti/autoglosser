<!DOCTYPE html>
<html lang="eng">

<head>
    <meta charset="utf-8" />
    <title>Mòore to English~~</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js" type="text/javascript"></script>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css"
        type="text/css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"
        type="text/javascript"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            $("#submit").click(function () {
                var that = this;

                $("#results").text("");

                console.log($("#mooretextarea").val())
                var lines = $("#mooretextarea").val().split("\n");
                var joined = lines
                    .filter((line) => line.trim() !== " ")
                    .join("");

                console.log(joined);
                var data = { 'moore': joined };
                var url = "/moore/cgi-bin/autogloss.py";

                $.ajax({
                    type: "GET",
                    url: url,
                    data: data,
                    dataType: "JSON",
                    success: function (jsonStr) {
                        console.log("[" + url + "]: " + JSON.stringify(jsonStr));

                        if (jsonStr.hasOwnProperty("moore")) {
                            console.log(jsonStr["moore"]);
                            $("<p><i>Wordform in Mòoré (high tones marked)</i></p>").appendTo($("#results"));
                            $("<p>" + jsonStr["moore"] + "</p> <br>").appendTo($("#results"));
                        }

                        if (jsonStr.hasOwnProperty("gloss")) {
                            console.log(jsonStr["gloss"]);
                            $("<p><i>Gloss</i></p>").appendTo($("#results"));
                            $("<p>" + jsonStr["gloss"] + "</p> <br>").appendTo($("#results"));
                        }

                        if (jsonStr.hasOwnProperty("latexGloss")) {
                            console.log(jsonStr["latexGloss"]);
                            $("<p>" + jsonStr["latexGloss"] + "</p>").appendTo($("#results"));
                        }
                    },
                    error: function (
                        XMLHttpRequest,
                        textStatus,
                        errorThrown
                    ) {
                        console.log("[" + url + "]: Status: " + textStatus);
                        console.log("[" + url + "]: Error: " + errorThrown);
                        $("#results").text("");
                    },
                });
            });
        });
    </script>
</head>

<body>
    <div id="userinputform">
        <form>
            <textarea rows="5" cols="60" placeholder="Input text here." id="mooretextarea"></textarea>
            <br />
            <input type="button" value="submit" id="submit" style="cursor: pointer" />
        </form>
    </div>

    <div id="results"></div>

    <!-- <script src="script.js"></script> -->
</body>

</html>